#! /usr/bin/python3.2

import sys
import time
import subprocess
import os
from datetime import datetime,date
import time

for line in sys.stdin :

	proc =os.popen('python3.2 adulau/search.py -p '+line[4:-1]+' | grep CVSS').read()
	#search the cpe in the database
	tab_cvss=[]
	n=proc.find('\n')#searching the next end of line
	maxi=0.0;
	while(n>0):#while we have a end of line
		f=proc[0:n].find(':')
		if float(proc[f+2:n])>maxi :
		#searching the maximum cvss
			maxi=float(proc[f+2:n])
		tab_cvss.append(float(proc[f+2:n]))
		proc=proc[n+1:]
		n=proc.find('\n')
	moyenne=sum(tab_cvss)/len(tab_cvss)
	#determining the cvss average
	proc =os.popen('python3.2 adulau/search.py -p '+line[4:-1]+' | grep DATE').read()
	n=proc.find('\n')
	date_min=datetime.today()
	while(n>0):
		f=proc[0:n].find(':')
		t=proc[4:n].find('T')
		t=t+4
		date=datetime(int(proc[f+2:t-6]),int(proc[f+2+5:t-3]),int(proc[f+2+8:t]))
		if(date_min>date):
		#recovering the date of the first vulnerability
			date_min=date
		proc=proc[n+1:]
		n=proc.find('\n')
		
	print ("cpe:",line[4:-1]," maximum cvss:",maxi," average cvss: %.1f" % moyenne," minimum date:",date_min.strftime('%Y-%m-%d'))
			
